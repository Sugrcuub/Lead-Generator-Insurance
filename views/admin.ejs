<% layout('layout') %>

<% if (view === 'login') { %>
  <div class="row justify-content-center">
    <div class="col-md-5">
      <div class="card shadow-sm">
        <div class="card-body p-4">
          <h1 class="h4 mb-3">Admin Login</h1>
          <% if (typeof error !== 'undefined') { %>
            <div class="alert alert-danger"><%= error %></div>
          <% } %>
          <form method="post" action="/admin/login">
            <div class="mb-3">
              <label class="form-label">Password</label>
              <input type="password" name="password" class="form-control" required>
            </div>
            <button class="btn btn-primary w-100">Sign in</button>
          </form>
        </div>
      </div>
    </div>
  </div>
<% } %>

<% if (view === 'leads') { %>
  <div class="d-flex align-items-center mb-3">
    <h1 class="h4 mb-0">Leads</h1>
    <a class="btn btn-outline-secondary btn-sm ms-auto" href="/admin/export.csv">Export CSV</a>
  </div>
  <form class="mb-3" method="get" action="/admin/leads">
    <div class="input-group">
      <input class="form-control" type="search" placeholder="Search name, email, phone, type" name="q" value="<%= q %>">
      <button class="btn btn-outline-secondary">Search</button>
    </div>
  </form>
  <div class="table-responsive">
    <table class="table align-middle">
      <thead>
        <tr>
          <th>Date</th>
          <th>Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Type</th>
          <th>Notes</th>
          <th>Source</th>
        </tr>
      </thead>
      <tbody>
        <% if (!leads.length) { %>
          <tr><td colspan="7" class="text-muted">No leads yet.</td></tr>
        <% } %>
        <% leads.forEach(l => { %>
          <tr>
            <td class="text-nowrap"><%= new Date(l.created_at).toLocaleString() %></td>
            <td><%= l.name %></td>
            <td><a href="mailto:<%= l.email %>"><%= l.email %></a></td>
            <td><a href="tel:<%= l.phone %>"><%= l.phone %></a></td>
            <td><span class="badge text-bg-light"><%= l.insurance_type %></span></td>
            <td><%= l.message || '' %></td>
            <td class="text-muted"><%= l.source || '' %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
<% } %>
